MOLINFO STRUCTURE=ref.pdb

WHOLEMOLECULES ENTITY0=1-3261 ENTITY1=3436-3442

# Group definition
pocket: GROUP NDX_FILE=index.ndx NDX_GROUP=Pocket_refined_noh
site: GROUP NDX_FILE=index.ndx NDX_GROUP=Oxygens
CaM_EF2: GROUP NDX_FILE=index.ndx NDX_GROUP=CAM_EF2

WRAPAROUND ATOMS=CaM_EF2 AROUND=site

pocket_center: COM ATOMS=pocket
site_center: COM ATOMS=site
CaM_center: COM ATOMS=CaM_EF2

pocket_coord: POSITION ATOM=pocket_center NOPBC
site_coord: POSITION ATOM=site_center NOPBC
CaM_coord: POSITION ATOM=CaM_center NOPBC


Delta_x: MATHEVAL ARG=CaM_coord.x,site_coord.x FUNC=x-y PERIODIC=NO
Delta_y: MATHEVAL ARG=CaM_coord.y,site_coord.y FUNC=x-y PERIODIC=NO
Delta_z: MATHEVAL ARG=CaM_coord.z,site_coord.z FUNC=x-y PERIODIC=NO

rho: MATHEVAL ARG=Delta_x,Delta_y,Delta_z FUNC=sqrt(x*x+y*y+z*z) PERIODIC=NO
theta: MATHEVAL ARG=Delta_z,rho FUNC=acos(x/y) PERIODIC=0.,pi
phi: MATHEVAL ARG=Delta_x,Delta_y FUNC=atan2(y,x) PERIODIC=-pi,pi


# RMSD and Coordination number
rmsd: RMSD REFERENCE=npt_ca.pdb TYPE=OPTIMAL
c: COORDINATION GROUPA=CaM_EF2 GROUPB=pocket R_0=0.45

# Restraining potential of the section of sphere
restr_rho: UPPER_WALLS ARG=rho AT=3.0 KAPPA=20000 OFFSET=0


# Metadynamics
metad: METAD ... 
   ARG=rho,theta,phi
   PACE=500 #MD steps, every 1 ps 

   # These parameters change in the four simulations
   HEIGHT=1.2
   BIASFACTOR=8

   # Width of Gaussians (in nm)
   SIGMA=0.02,pi/64.,pi/32.

   # Use a "large" grid
   GRID_MIN=0.,0.,-pi 
   GRID_MAX=3.5,pi,pi

   # Define information on the walkers
   WALKERS_N=4
   WALKERS_ID=1

   # Each simulation reads the hills files every 1 ps 
   WALKERS_RSTRIDE=500
   
   # I have 4 subfolders in the working directory
   WALKERS_DIR=../

   # Recover the c(t) for reweighting
   CALC_RCT
   TEMP=310
...


PRINT ARG=metad.* FILE=metad_data.dat STRIDE=500
PRINT ARG=restr_rho.* FILE=sphere_restraint.dat STRIDE=500
PRINT ARG=pocket_coord.x,pocket_coord.y,pocket_coord.z FILE=pocket_coord.dat STRIDE=500
PRINT ARG=CaM_coord.x,CaM_coord.y,CaM_coord.z FILE=CaM_coord.dat STRIDE=500
PRINT ARG=site_coord.x,site_coord.y,site_coord.z FILE=site_coord.dat STRIDE=500
PRINT ARG=rho,theta,phi FILE=rtp_coord.dat STRIDE=500
PRINT ARG=rmsd FILE=rmsd.dat STRIDE=500
PRINT ARG=c FILE=coord_number_45.dat STRIDE=500

DUMPMASSCHARGE FILE=mcfile

FLUSH STRIDE=500
MOLINFO STRUCTURE=npt.pdb

# Group definition
prot_noh: GROUP NDX_FILE=index.ndx NDX_GROUP=Protein_noh
ref: GROUP NDX_FILE=index.ndx NDX_GROUP=C-alpha
site: GROUP NDX_FILE=index.ndx NDX_GROUP=Oxygens
CaM_EF2: GROUP NDX_FILE=index.ndx NDX_GROUP=CAM_EF2


ref_center: COM ATOMS=ref
site_center: COM ATOMS=site
CaM_center: COM ATOMS=CaM_EF2

ref_coord: POSITION ATOM=ref_center
site_coord: POSITION ATOM=site_center
CaM_coord: POSITION ATOM=CaM_center


Delta_x: MATHEVAL ARG=CaM_coord.x,site_coord.x FUNC=x-y PERIODIC=NO
Delta_y: MATHEVAL ARG=CaM_coord.y,site_coord.y FUNC=x-y PERIODIC=NO
Delta_z: MATHEVAL ARG=CaM_coord.z,site_coord.z FUNC=x-y PERIODIC=NO

rho: DISTANCE ATOMS=CaM_center,site_center
theta: MATHEVAL ARG=Delta_z,rho FUNC=acos(x/y) PERIODIC=0,pi
phi: MATHEVAL ARG=Delta_x,Delta_y FUNC=atan2(y,x) PERIODIC=-pi/2,pi/2


rmsd: RMSD REFERENCE=npt_ca.pdb TYPE=OPTIMAL

# Restraining potential of the section of sphere
restr_rho: UPPER_WALLS ARG=rho AT=3.0 KAPPA=20000 OFFSET=0
restr_theta_up: UPPER_WALLS ARG=theta AT=pi/6 KAPPA=20000 OFFSET=0
restr_theta_low: LOWER_WALLS ARG=theta AT=5*pi/6 KAPPA=20000 OFFSET=0
restr_rmsd: UPPER_WALLS ARG=rmsd AT=0.10 EXP=1 KAPPA=20000 OFFSET=0


# Metadynamics
METAD ...
ARG=rho,theta,phi
GRID_MIN=0,0,-pi/2
GRID_MAX=3.2,pi,pi/2
SIGMA=0.01,pi/64,pi/32
HEIGHT=1.2
PACE=500 #MD steps, every 1 ps
BIASFACTOR=10
TEMP=310
LABEL=metad
CALC_RCT
... METAD

PRINT ARG=metad.* FILE=metad_data.dat STRIDE=500
PRINT ARG=restr_rho.*,restr_rmsd.* FILE=sphere_restraint.dat STRIDE=500
PRINT ARG=ref_coord.x,ref_coord.y,ref_coord.z FILE=ref_coord.dat STRIDE=500
PRINT ARG=CaM_coord.x,CaM_coord.y,CaM_coord.z FILE=CaM_coord.dat STRIDE=500
PRINT ARG=site_coord.x,site_coord.y,site_coord.z FILE=site_coord.dat STRIDE=500
PRINT ARG=rho,theta,phi FILE=rtp_coord.dat STRIDE=500
PRINT ARG=rmsd FILE=rmsd.dat STRIDE=500

DUMPMASSCHARGE FILE=mcfile

FLUSH STRIDE=500

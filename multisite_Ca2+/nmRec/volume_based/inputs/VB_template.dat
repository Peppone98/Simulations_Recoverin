WHOLEMOLECULES ENTITY0=1-1774 ENTITY1=1775-1857
FIT_TO_TEMPLATE REFERENCE=ref_cytc_5lft_ca.pdb TYPE=OPTIMAL

# Group definition
prot_noh: GROUP NDX_FILE=index.ndx NDX_GROUP=Protein_hec_fe_noh
ref: GROUP NDX_FILE=index.ndx NDX_GROUP=Protein_ca
site: GROUP NDX_FILE=index.ndx NDX_GROUP=site1
site_tot: GROUP NDX_FILE=index.ndx NDX_GROUP=site1_tot
site2_tot: GROUP NDX_FILE=index.ndx NDX_GROUP=site2_tot
SP4: GROUP NDX_FILE=index.ndx NDX_GROUP=SP4_noh

WRAPAROUND ATOMS=SP4 AROUND=prot_noh

ref_center: COM ATOMS=ref
site_center: COM ATOMS=site
SP4_center: COM ATOMS=SP4

Fix: FIXEDATOM AT=4.97,4.62,6.50
#Dis_cm_atfix: DISTANCE ATOMS=ref_center,Fix
Dis: DISTANCE ATOMS=site_center,Fix

ref_coord: POSITION ATOM=ref_center NOPBC
site_coord: POSITION ATOM=site_center NOPBC
SP4_coord: POSITION ATOM=SP4_center NOPBC


Delta_x: MATHEVAL ARG=SP4_coord.x,site_coord.x FUNC=x-y PERIODIC=NO
Delta_y: MATHEVAL ARG=SP4_coord.y,site_coord.y FUNC=x-y PERIODIC=NO
Delta_z: MATHEVAL ARG=SP4_coord.z,site_coord.z FUNC=x-y PERIODIC=NO

rho: MATHEVAL ARG=Delta_x,Delta_y,Delta_z FUNC=sqrt(x*x+y*y+z*z) PERIODIC=NO
theta: MATHEVAL ARG=Delta_z,rho FUNC=acos(x/y) PERIODIC=0,pi
phi: MATHEVAL ARG=Delta_x,Delta_y FUNC=atan2(y,x) PERIODIC=-pi,pi


rmsd: RMSD REFERENCE=ref_cytc_5lft_ca.pdb TYPE=OPTIMAL

# Restraining potential of the sphere
#restr_dis_cm_atfix: UPPER_WALLS ARG=Dis_cm_atfix AT=1.00 KAPPA=20000 OFFSET=0
restr_rho: UPPER_WALLS ARG=rho AT=3.0 KAPPA=20000 OFFSET=0
#restr_theta_up: UPPER_WALLS ARG=theta AT=pi/3 KAPPA=20000 OFFSET=0
#restr_theta_low: LOWER_WALLS ARG=theta AT=-pi/3 KAPPA=20000 OFFSET=0
restr_rmsd: UPPER_WALLS ARG=rmsd AT=0.10 EXP=1 KAPPA=20000 OFFSET=0


# Coordination number
c: COORDINATION GROUPA=SP4 GROUPB=site_tot R_0=0.45
c2: COORDINATION GROUPA=SP4 GROUPB=site2_tot R_0=0.45

# Metadynamics
METAD ...
ARG=rho,theta,phi
GRID_MIN=0,0,-pi
GRID_MAX=3.2,pi,pi
SIGMA=0.1,pi/16,pi/8
HEIGHT=1.2
PACE=500 #MD steps, every 1 ps
BIASFACTOR=10
TEMP=300
LABEL=metad
CALC_RCT
... METAD

PRINT ARG=metad.* FILE=metad_data.dat STRIDE=500
PRINT ARG=restr_rho.*,restr_rmsd.* FILE=sphere_restraint.dat STRIDE=500
PRINT ARG=ref_coord.x,ref_coord.y,ref_coord.z FILE=ref_coord.dat STRIDE=500
PRINT ARG=SP4_coord.x,SP4_coord.y,SP4_coord.z FILE=SP4_coord.dat STRIDE=500
PRINT ARG=site_coord.x,site_coord.y,site_coord.z FILE=site_coord.dat STRIDE=500
PRINT ARG=rho,theta,phi FILE=rtp_coord.dat STRIDE=500
PRINT ARG=c FILE=all_coordination_45.dat STRIDE=500
PRINT ARG=c2 FILE=coordination_site2_45.dat STRIDE=500
PRINT ARG=rmsd FILE=rmsd.dat STRIDE=500
PRINT ARG=Dis FILE=distance.dat STRIDE=500

FLUSH STRIDE=500
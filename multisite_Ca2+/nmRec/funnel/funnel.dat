MOLINFO STRUCTURE=ref.pdb

WHOLEMOLECULES ENTITY0=1-3261 ENTITY1=3436-3442

# Group definition
pocket: GROUP NDX_FILE=index.ndx NDX_GROUP=Pocket_refined_noh
site: GROUP NDX_FILE=index.ndx NDX_GROUP=Oxygens
CaM_EF2: GROUP NDX_FILE=index.ndx NDX_GROUP=CAM_EF2


WRAPAROUND ATOMS=CaM_EF2 AROUND=site

pocket_center: COM ATOMS=pocket
site_center: COM ATOMS=site
CaM_center: COM ATOMS=CaM_EF2

pocket_coord: POSITION ATOM=pocket_center NOPBC
site_coord: POSITION ATOM=site_center NOPBC
CaM_coord: POSITION ATOM=CaM_center NOPBC


Delta_x: MATHEVAL ARG=CaM_coord.x,site_coord.x FUNC=x-y PERIODIC=NO
Delta_y: MATHEVAL ARG=CaM_coord.y,site_coord.y FUNC=x-y PERIODIC=NO
Delta_z: MATHEVAL ARG=CaM_coord.z,site_coord.z FUNC=x-y PERIODIC=NO

rho: MATHEVAL ARG=Delta_x,Delta_y,Delta_z FUNC=sqrt(x*x+y*y+z*z) PERIODIC=NO
theta: MATHEVAL ARG=Delta_z,rho FUNC=acos(x/y) PERIODIC=0.,pi
phi: MATHEVAL ARG=Delta_x,Delta_y FUNC=atan2(y,x) PERIODIC=-pi,pi


# RMSD and Coordination number
rmsd: RMSD REFERENCE=npt_ca.pdb TYPE=OPTIMAL
c: COORDINATION GROUPA=CaM_EF2 GROUPB=pocket R_0=0.45

fps: FUNNEL_PS ...
   LIGAND=lig
   REFERENCE=pocket.pdb 
   ANCHOR=1196
   POINTS=
...


funnel: FUNNEL ...
   ARG=fps.lp,fps.ld 
   ZCC=2.5
   ALPHA=0.5 
   RCYL=0.2 
   MINS=0.0 
   MAXS=6.0 
   KAPPA=30000  
   NBINS=500 
   NBINZ=500
   FILE=BIAS 
...


# Define the group of atoms 
cm_prot: COM ATOMS=1-3261
cm_O: COM ATOMS=1175,1196,1222,1245,1330,1331
d1: DISTANCE ATOMS=cm_O,lig
d2: DISTANCE ATOMS=cm_prot,lig


# Define the multiple walkers metadynamics
metad: METAD ... 
   ARG=d1
   PACE=10000 

   # These parameters change in the four simulations
   HEIGHT=1.5 
   BIASFACTOR=20  

   # From 10 ns of unbiased simulation (in nm)
   SIGMA=0.012 

   # Use a "large" grid
   GRID_MIN=0 
   GRID_MAX=7.0

   # Recover the c(t) for reweighting
   CALC_RCT
...


rmsd: RMSD ...
      REFERENCE=ref_CA.pdb 
      TYPE=OPTIMAL
...


# Restraint on the rmsd
uwall-rmsd: UPPER_WALLS ...
            ARG=rmsd 
            AT=0.12 
            KAPPA=500000 
            EXP=2 
            OFFSET=0 
...


# Restraint the position of the ligand inside the funnel
lwall: LOWER_WALLS ...
   ARG=fps.lp 
   AT=0.1 
   KAPPA=40000 
   EXP=2 
   OFFSET=0
...


uwall: UPPER_WALLS ...
   ARG=fps.lp 
   AT=6.0 
   KAPPA=40000 
   EXP=2 
   OFFSET=0
... 

PRINT STRIDE=500 ARG=* FILE=COLVAR

MOLINFO STRUCTURE=ref.pdb

WHOLEMOLECULES ENTITY0=1-3261 ENTITY1=3436-3442

# Group definition
pocket: GROUP NDX_FILE=index.ndx NDX_GROUP=Pocket_refined_noh
site: GROUP NDX_FILE=index.ndx NDX_GROUP=Oxygens
CaM_EF2: GROUP NDX_FILE=index.ndx NDX_GROUP=CAM_EF2


WRAPAROUND ATOMS=CaM_EF2 AROUND=site

pocket_center: COM ATOMS=pocket
site_center: COM ATOMS=site
CaM_center: COM ATOMS=CaM_EF2

pocket_coord: POSITION ATOM=pocket_center NOPBC
site_coord: POSITION ATOM=site_center NOPBC
CaM_coord: POSITION ATOM=CaM_center NOPBC


Delta_x: MATHEVAL ARG=CaM_coord.x,site_coord.x FUNC=x-y PERIODIC=NO
Delta_y: MATHEVAL ARG=CaM_coord.y,site_coord.y FUNC=x-y PERIODIC=NO
Delta_z: MATHEVAL ARG=CaM_coord.z,site_coord.z FUNC=x-y PERIODIC=NO

rho: MATHEVAL ARG=Delta_x,Delta_y,Delta_z FUNC=sqrt(x*x+y*y+z*z) PERIODIC=NO
theta: MATHEVAL ARG=Delta_z,rho FUNC=acos(x/y) PERIODIC=0.,pi
phi: MATHEVAL ARG=Delta_x,Delta_y FUNC=atan2(y,x) PERIODIC=-pi,pi


# RMSD and Coordination number
rmsd: RMSD REFERENCE=npt_ca.pdb TYPE=OPTIMAL
c: COORDINATION GROUPA=CaM_EF2 GROUPB=pocket R_0=0.45

fps: FUNNEL_PS ...
   LIGAND=CaM_center
   REFERENCE=pocket_noh.pdb 
   ANCHOR=1197
   POINTS=3.818,4.902,5.079,3.567,4.882,5.918
...


funnel: FUNNEL ...
   ARG=fps.lp,fps.ld 
   ZCC=2.5
   ALPHA=0.4 
   RCYL=0.2 
   MINS=0.0 
   MAXS=4.0 
   KAPPA=30000  
   NBINS=500 
   NBINZ=500
   FILE=BIAS 
...



# Define the metadynamics
metad: METAD ... 
   ARG=rho,theta,phi
   PACE=500 

   # These parameters change in the four simulations
   HEIGHT=1.2 
   BIASFACTOR=10  

   # Width of Gaussians (in nm)
   SIGMA=0.01,pi/128.,pi/64. 

   # Use a "large" grid
   GRID_MIN=0.,0.,-pi 
   GRID_MAX=4.0,pi,pi

   # Recover the c(t) for reweighting
   CALC_RCT
...



# Restraint on the rmsd
uwall-rmsd: UPPER_WALLS ...
            ARG=rmsd 
            AT=0.12 
            KAPPA=500000 
            EXP=2 
            OFFSET=0 
...


# Restraint the position of the ligand inside the funnel
lwall: LOWER_WALLS ...
   ARG=fps.lp 
   AT=0.2 
   KAPPA=40000 
   EXP=2 
   OFFSET=0
...


uwall: UPPER_WALLS ...
   ARG=fps.lp 
   AT=3.8 
   KAPPA=40000 
   EXP=2 
   OFFSET=0
... 

#PRINT STRIDE=500 ARG=* FILE=COLVAR

PRINT ARG=metad.* FILE=metad_data.dat STRIDE=500
PRINT ARG=pocket_coord.x,pocket_coord.y,pocket_coord.z FILE=pocket_coord.dat STRIDE=500
PRINT ARG=CaM_coord.x,CaM_coord.y,CaM_coord.z FILE=CaM_coord.dat STRIDE=500
PRINT ARG=site_coord.x,site_coord.y,site_coord.z FILE=site_coord.dat STRIDE=500
PRINT ARG=rho,theta,phi FILE=rtp_coord.dat STRIDE=500
PRINT ARG=rmsd FILE=rmsd.dat STRIDE=500
PRINT ARG=c FILE=coord_number_45.dat STRIDE=500

# Print restraints
PRINT ARG=lwall.*,uwall.*,uwall-rmsd.*,fps.*,funnel.bias FILE=restraints.dat STRIDE=500

DUMPMASSCHARGE FILE=mcfile

FLUSH STRIDE=500
